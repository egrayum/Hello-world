<html>
 <head>
  <title>turtlekins game</title>
  <link rel="stylesheet" type="text/css" href="labs.css"></link>
  <canvas id="gameCanvas" style="background:#047018; width:100%; height:100%; text-align:center;">
  <script>
   var c = document.getElementById("gameCanvas");
   var ctx = c.getContext("2d");
   var pX = 100;
   var pY = 100;
   var direct;
   var click;
   var screen = 1;
   var coins = 0;
   var room;
   var oldpX;
   var oldpY;
   var layout = [];
   var roomPos;
   var posChangeX;
   var posChangeY;
   var posStore = [];
   var i;
   var direction;
   var found;
   var nType = [1, 2, 4, 5, 7, 8, 11];
   var sType = [1, 2, 4, 6, 9, 10, 11];
   var eType = [3, 4, 5, 6, 8, 10, 11];
   var wType = [2, 3, 5, 6, 7, 9, 11];
   var roomImage = new Image();
   var tokens = 0;
   var rand;
   var obtain;
   var discRooms = 0;
   var level = 0;
   var colorA = ["#f9ae0d", "#7aa5f6", "#047018", "#742727", "#d74805", "#ff0a0a", "#031a69", "#2d9186"];
   var color = colorA[2];
   var speed = 5;
   var dashT = 2;
   var attack;
   var enemies = 0;
   var eX;
   var eY;
   var oldeX;
   var oldeY;
   var pHealth = 100;
   var eHealth = 50;
   var eDirect;
   var secretA = [];
   var sfound;
   var rad = 75;
   var hunger = 10;
   var run = 0;
    function resetDash() {
     dashT = 2;
    }
    function stopDash() {
     dashT = 1;
    }
   function checkSecret() {
    room = layout[i].type;
    if (direction == "N") {
     if (room == 3 || room == 6 || room == 9 || room == 10) {
      room = 99;
     }
    } else if (direction == "S") {
     if (room == 3 || room == 5 || room == 7 || room == 8) {
      room = 100;
     }
    } else if (direction == "E") {
     if (room == 1 || room == 7 || room == 2 || room == 9) {
      room = 101;   
     }
    } else if (direction == "W") {
     if (room == 1 || room == 4 || room == 8 || room == 10) {
      room = 102;
      pX = 744;
     }
    }
    found = 2;
   }
   function collision(ifs) {
    if (ifs) {
       pX = oldpX;
       pY = oldpY;
      } else { 
       oldpX = pX;
       oldpY = pY;
      }
   }
   function eCollision(ifn) {
    if (ifn) {
       eX = oldeX;
       eY = oldeY;
      } else { 
       eldpX = eX;
       eldpY = eY;
      }
   }
   function init() {
    c.width = 800;
    c.height = 600;
    ctx.fillStyle = "#111";
    ctx.font = "20px Arial";
    ctx.fillText("Click to start", 250, 320);
    click = 1;
   }
   c.onmousedown = function clickStuff() {
    if (click == 1) {
     click = undefined;
     window.setInterval(runGame, 20);
     window.setInterval(attacks, 400);
    }
   }
   document.addEventListener("keyup", function(event) {
    if (event.keyCode == 37 || event.keyCode == 38 || event.keyCode == 39 || event.keyCode == 40) {
     direct = undefined; 
    } else if (event.keyCode == 87 || event.keyCode == 65 || event.keyCode == 68 || event.keyCode == 83) {
     attack = 0;
    } else if (event.keyCode == 32) {
     run = 0;
    }
   })
   document.addEventListener("keydown", function(event) {
    if (event.keyCode == 37) {
     direct = 1;
    } else if (event.keyCode == 38) {
     direct = 2; 
    } else if (event.keyCode == 39) {
     direct = 3;
    } else if (event.keyCode == 40) {
     direct = 4;
    } else if (event.keyCode == 32) {
     run = 1;
    } else if (event.keyCode == 16 && dashT == 2) {
     dashT = 0;
    } else if (event.keyCode == 87) {
     attack = 1;
    } else if (event.keyCode == 65) {
     attack = 2;
    } else if (event.keyCode == 83) {
     attack = 3;
    } else if (event.keyCode == 68) {
     attack = 4;
    } else if (event.keyCode == 87 && event.keyCode == 37) {
     window.setTimeout(resetDash, 3200);
    }
   })
   function runGame() {
    ctx.fillStyle = color;
    ctx.fillRect(0, 0, c.width, c.height);
    // above ground
    if (screen == 1) {
     ctx.fillStyle = "#DEB887";
     ctx.fillRect(250, 20, 300, 200);
     ctx.fillStyle = "#333";
     ctx.font = "35px Arial";
     ctx.fillText("Shop", 260, 55);
     ctx.fillStyle = "#000";
     ctx.fillRect(600, 400, 180, 180);
     ctx.fillText("Mine", 620, 380);
     eX = undefined;
     eY = undefined;
     enemies = 0;
     if (pX > 560 && pY > 360) {
      level = 1;
      screen = 2;
      room = 11;
      roomPos = "1,1";
      pX = 375;
      pY = 275;
      layout[0] = {
       "type":11,
       "pos":"1,1"
      }
     }
    } else if (screen == 2) {
     ctx.fillStyle = "rgba(20, 20, 20, 0.7)";
     if (room == 1) {
      // I
      ctx.fillRect(0, 0, 300, c.height);
      ctx.fillRect(500, 0, 300, c.height);
      collision(pX < 300 || pX > 450);
      eCollision(pX < 300 || pX > 450);
     } else if (room == 2) {
      // T from the left
      ctx.fillRect(0, 0, 300, c.height); 
      ctx.fillRect(500, 0, 300, 200);
      ctx.fillRect(500, 400, 300, 200);
      collision(pX < 300 || pX > 450 && pY < 200 || pX > 450 && pY > 350);
      eCollision(pX < 300 || pX > 450 && pY < 200 || pX > 450 && pY > 350);
     } else if (room == 3) { 
      // I on its side
      ctx.fillRect(0, 0, c.width, 200);
      ctx.fillRect(0, 400, c.width, 200);
      collision(pY < 200 || pY > 350);
      eCollision(pY < 200 || pY > 350);
     } else if (room == 4) {
      // T from the right
      ctx.fillRect(0, 0, 300, 200);
      ctx.fillRect(500, 0, 300, c.height);
      ctx.fillRect(0, 400, 300, 200);
      collision(pX > 450 || pX < 300 && pY > 350 || pX < 300 && pY < 200);
      eCollision(pX > 450 || pX < 300 && pY > 350 || pX < 300 && pY < 200);
     } else if (room == 5) {
      // T
      ctx.fillRect(0, 0, c.width, 200);
      ctx.fillRect(500, 400, 300, 200);
      ctx.fillRect(0, 400, 300, 200);
      collision(pY < 200 || pY > 350 && pX < 300 || pY > 350 && pX > 450);
      eCollision(pY < 200 || pY > 350 && pX < 300 || pY > 350 && pX > 450);
     } else if (room == 6) {
      // upside-down T
      ctx.fillRect(0, 400, c.width, 200);
      ctx.fillRect(0, 0, 300, 200);
      ctx.fillRect(500, 0, 300, 200);
      collision(pY > 350 || pY < 200 && pX < 300 || pY < 200 && pX > 450);
      eCollision(pY > 350 || pY < 200 && pX < 300 || pY < 200 && pX > 450);
     } else if (room == 7) {
      // Upside-down L
      ctx.fillRect(0, 0, c.width, 200);
      ctx.fillRect(0, 200, 300, 400);
      ctx.fillRect(500, 400, 300, 200);
      collision(pX < 300 || pY < 200 || pX > 450 && pY > 350);
      eCollision(pX < 300 || pY < 200 || pX > 450 && pY > 350);
     } else if (room == 8) {
      // Rotated L
      ctx.fillRect(0, 0, c.width, 200);
      ctx.fillRect(500, 200, 300, 400);
      ctx.fillRect(0, 400, 300, 200);
      collision(pY < 200 || pX > 450 || pY > 350 && pX < 300);
      eCollision(pY < 200 || pX > 450 || pY > 350 && pX < 300);
     } else if (room == 9) {
      // L
      ctx.fillRect(0, 0, 300, c.height);
      ctx.fillRect(300, 400, 500, 200);
      ctx.fillRect(500, 0, 300, 200);
      collision(pX < 300 || pY > 350 || pX > 450 && pY < 200);
      eCollision(pX < 300 || pY > 350 || pX > 450 && pY < 200);
     } else if (room == 10) {
      // Reflected L
      ctx.fillRect(0, 0, 300, 200);
      ctx.fillRect(0, 400, c.width, 200);
      ctx.fillRect(500, 0, 300, 400);
      collision(pX > 450 || pY > 350 || pY < 200 && pX < 300);
      eCollision(pX > 450 || pY > 350 || pY < 200 && pX < 300);
     } else if (room == 11) { 
      // Plus
      ctx.fillRect(0, 0, 300, 200);
      ctx.fillRect(500, 0, 300, 200);
      ctx.fillRect(500, 400, 300, 200);
      ctx.fillRect(0, 400, 300, 200);
      collision(pX < 300 && pY < 200 || pX > 450 && pY < 200 || pX > 450 && pY > 350 || pX < 300 && pY > 350);
      eCollision(pX < 300 && pY < 200 || pX > 450 && pY < 200 || pX > 450 && pY > 350 || pX < 300 && pY > 350);
     } else if (room == 99) {
      // secret room enterable going N
      ctx.fillRect(0, 0, c.width, 100);
      ctx.fillRect(0, 100, 100, 400);
      ctx.fillRect(700, 100, 100, 400);
      ctx.fillRect(0, 500, 300, 100);
      ctx.fillRect(500, 500, 300, 100);
      collision(pX < 100 || pX > 650 || pY < 100 || pY > 450 && pX < 300 || pY > 450 && pX > 450);
      eCollision(pX < 100 || pX > 650 || pY < 100 || pY > 450 && pX < 300 || pY > 450 && pX > 450);
     } else if (room == 100) {
      // secret room enterable going S
      ctx.fillRect(0, 100, 100, 400);
      ctx.fillRect(0, 0, 300, 100);
      ctx.fillRect(0, 500, c.width, 100);
      ctx.fillRect(500, 0, 300, 100);
      ctx.fillRect(700, 100, 100, 400);
     // roomImage.src = "https://raw.githubusercontent.com/egrayum/Hello-world/master/IMG/F1C10881-3FE7-4D5D-B920-669919111E1E.png";
     // ctx.drawImage(roomImage, 0, 0, 800, 600);
      collision(pX < 100 || pX > 650 || pY > 450 || pY < 100 && pX < 300 || pY < 100 && pX > 450);
      eCollision(pX < 100 || pX > 650 || pY > 450 || pY < 100 && pX < 300 || pY < 100 && pX > 450);
     } else if (room == 101) {
      // room enterable going E
      ctx.fillRect(100, 0, 600, 100);
      ctx.fillRect(700, 0, 100, c.height);
      ctx.fillRect(100, 500, 600, 100);
      ctx.fillRect(0, 0, 100, 200);
      ctx.fillRect(0, 400, 100, 200);
      collision(pX > 650 || pY < 100 || pY > 450 || pX < 100 && pY < 200 || pX < 100 && pY > 350);
      eCollision(pX > 650 || pY < 100 || pY > 450 || pX < 100 && pY < 300 || pX < 100 && pY > 350);
     } else if (room == 102) {
      // enterable going W
      ctx.fillRect(100, 0, 600, 100);
      ctx.fillRect(0, 0, 100, c.height);
      ctx.fillRect(100, 500, 600, 100);
      ctx.fillRect(700, 0, 100, 200);
      ctx.fillRect(700, 400, 100, 200);
      collision(pX < 100 || pY < 100 || pY > 450 || pX > 650 && pY < 200 || pX > 650 && pY > 350);
      eCollision(pX < 100 || pY < 100 || pY > 450 || pX > 650 && pY < 300 || pX > 650 && pY > 350);
     }
     if (pX < 5) {
      posStore = roomPos.split(",");
      posChangeX = parseInt(posStore[0], 10);
      posChangeY = posStore[1];
      posChangeX -= 1;
      posChangeX.toString(10);
      roomPos = posChangeX + "," + posChangeY;
      direction = "W";
      checkRoom();
      beenHere();
      pX = 744;
     } else if (pX > 745) {
      posStore = roomPos.split(",");
      posChangeX = parseInt(posStore[0], 10);
      posChangeY = posStore[1];
      posChangeX += 1;
      posChangeX.toString(10);
      roomPos = posChangeX + "," + posChangeY;
      direction = "E";
      checkRoom();
      beenHere();
      pX = 10;
     } else if (pY < 5) {
      posStore = roomPos.split(",");
      posChangeY = parseInt(posStore[1], 10);
      posChangeX = posStore[0];
      posChangeY += 1;
      posChangeY.toString(10);
      roomPos = posChangeX + "," + posChangeY;
      direction = "N";
      checkRoom();
      beenHere();
      pY = 545;
     } else if (pY > 545) {
      posStore = roomPos.split(",");
      posChangeY = parseInt(posStore[1], 10);
      posChangeX = posStore[0];
      posChangeY -= 1;
      posChangeY.toString(10);
      roomPos = posChangeX + "," + posChangeY;
      direction = "S";
      checkRoom();
      beenHere();
      pY = 10;
     }
     ctx.fillStyle = "#2543e6";
     ctx.fillRect(275, 10, pHealth * 5, 24);
     ctx.fillStyle = "#d37112";
     ctx.fillRect(275, 34, hunger * 50, 16);
     ctx.fillStyle = "#fff";
     ctx.font = "20px Arial";
     ctx.fillText("health: " + pHealth + "/100", 280, 30);
     ctx.font = "12px Arial";
     ctx.fillText("hunger: " + Math.round(hunger) + "/10", 280, 46);
    }
    // check if the room exists
    function checkRoom() {
     found = 1;
     for (i = 0; i < layout.length; i++) {
      if (layout[i].pos == roomPos) {
       room = layout[i].type;
       checkSecret();
       found = 2;
      } 
     }
     if (found == 1) {
       addRoom();
      }
    }
    // function that adds a room to the array
    function addRoom () {
     i = 2;
     rad = 75;
     enemies = 1;
     if (enemies == 1) {
      eX = 300;
      eY = 200;
     }
     discRooms++;
     if (direction == "N") {
      room = nType[Math.round(Math.random() * (nType.length - 1))];
      layout[layout.length] = {
       "type":room,
       "pos":roomPos
      }
     } else if (direction == "E") {
      room = eType[Math.round(Math.random() * (eType.length - 1))];
      layout[layout.length] = {
       "type":room,
       "pos":roomPos
      }
     } else if (direction == "W") {
      room = wType[Math.round(Math.random() * (wType.length - 1))];
      layout[layout.length] = {
       "type":room,
       "pos":roomPos
      }
     } else if (direction == "S") {
     room = sType[Math.round(Math.random() * (sType.length - 1))];
      layout[layout.length] = {
       "type":room,
       "pos":roomPos
      }
     }
    }
    if (discRooms == 8 + (level * 2)) {
     ctx.fillStyle = "#000";
     ctx.beginPath();
     ctx.arc(400, 300, rad, 0, 2 * Math.PI);
     ctx.fill();
     if (pX > 299 && pX < 451 && pY > 199 && pY < 351 && rad < 820) {
      rad += 10;
      if (i == 2) {
       window.setTimeout(nextLevel, 1500);
       i = 0;
      }
     }
    }
    function beenHere() {
    if (room == 99 || room == 100 || room == 101 || room == 102) {
      sfound = 1;
      for (i = 0; i < secretA.length; i++) {
       if (secretA[i].pos == roomPos) {
        rand = 0;
        sfound = 2;
       } 
      }
      if (sfound == 1) {
       rand = 10;
       secretA[secretA.length] = {
        "pos":roomPos
       }
      }
     }
    }
    if (rand == 10) {
     obtain = 0;
     special = 15;
     if (special == 15 && obtain == 0) {
      ctx.fillStyle = "#0000ff";
      ctx.fillRect(375, 275, 50, 50);
      if (pX > 324 && pX < 426 && pY > 224 && pY < 326) {
       obtain = 1;
       tokens += 1;
       coins += 50;
       rand = 0;
       special = 0;
       dashT = 2;
       if (health < 80) {
        health += 15;
       }
       if (speed < 12) {
        speed++;
       }
      }
     } 
    } 
    // enemy AI
    if (pX + 49 < eX) {
     eX -= 5 + level/4;
     eDirect = 2;
    } else if (pX > eX + 49) {
     eX += 5 + level/4;
     eDirect = 4;
    }
    // for moving the player
    function move(speeds) {
     if (direct == 1 && pX - 5 > - 5) {
      pX -= speed;
     } else if (direct == 2 && pY - 5 > - 5) {
      pY -= speed;
     } else if (direct == 3 && pX + 5 < 755) {
      pX += speed;
     } else if (direct == 4 && pY + 5 < 555) {
      pY += speed;
     }
    }
    move(speed);
    // for running
    if (run == 0 && hunger < 10) {
     hunger += 0.01;
    } else if (run == 1 && hunger > 0) {
     hunger -= 0.05;
     move(speed + 3);
    }
    if (hunger < 0) {
     hunger = 0;
    }
    // for dashing
    if (dashT == 0) {
     if (direct == 1 && pX - 5 > - 5) {
      pX -= 20;
      window.setTimeout(resetDash, 5200);
      window.setTimeout(stopDash, 200);
     } else if (direct == 2 && pY - 5 > - 5) {
      pY -= 20;
      window.setTimeout(resetDash, 5200);
      window.setTimeout(stopDash, 200);
     } else if (direct == 3 && pX + 5 < 755) {
      pX += 20;
      window.setTimeout(resetDash, 5200);
      window.setTimeout(stopDash, 200);
     } else if (direct == 4 && pY + 5 < 555) {
      pY += 20;
      window.setTimeout(resetDash, 5200);
      window.setTimeout(stopDash, 200);
     }
    }
    //player and stats
    if (dashT == 1 && tokens > 0) {
     ctx.fillStyle = "rgba(20, 20, 20, 0.6)";
    } else if (dashT == 1 && tokens < 1) {
     ctx.fillStyle = "rgba(0, 0, 0, 0.6)";
    } else if (dashT != 1 && tokens > 0) {
     ctx.fillStyle = "rgba(20, 20, 20, 1)";
    } else if (dashT != 1 && tokens < 1) {
     ctx.fillStyle = "rgba(0, 0, 0, 1)";
    }
    ctx.fillRect(pX, pY, 50, 50);
    if (enemies == 1) {
     ctx.fillStyle = "#ff0000";
     ctx.fillRect(eX, eY, 50, 50);
     ctx.fillRect(eX, eY - 24, eHealth, 8);
    }
    if (pHealth < 1) {
     screen = 1;
     coins /= 1.5;
     pHealth = 100;
    }
    if (eHealth < 1) {
     enemies = 0;
     eHealth = 50;
     eX = undefined;
     eY = undefined;
    }
    ctx.fillStyle = "#fff";
    ctx.font = "20px Arial";
    ctx.fillText("Blue tokens: " + tokens, 10, 75);
    ctx.fillText("Coins: " + coins, 10, 25);
    ctx.fillText("Level: " + level, 10, 100);
    if (room == 99 || room == 100 || room == 101 || room == 102) {
     ctx.fillText("Room position: Unknown", 10, 50);
    } else {
     ctx.fillText("Room position: " + roomPos, 10, 50);
    }
    ctx.fillStyle = "rgba(0, 0, 0, 1)";
    if (attack == 1) {
     ctx.fillRect(pX - 5, pY - 28, 10, 28);
     ctx.fillRect(pX + 45, pY - 28, 10, 28);
    } else if (attack == 2) {
     ctx.fillRect(pX - 28, pY - 5, 28, 10);
     ctx.fillRect(pX - 28, pY + 45, 28, 10);
    } else if (attack == 3) {
     ctx.fillRect(pX - 5, pY + 50, 10, 28);
     ctx.fillRect(pX + 45, pY + 50, 10, 28);
    } else if (attack == 4) {
     ctx.fillRect(pX + 50, pY - 5, 28, 10);
     ctx.fillRect(pX + 50, pY + 45, 28, 10);
    }
   } 
   function attacks() {
    // for taking damage
    if (pX > eX - 50 && pX < eX + 50 && pY > eY - 50 && pY < eY + 50 && pHealth > 0) {
     pHealth -= 10;
    }
    // attack stuff 
    ctx.fillStyle = "rgba(0, 0, 0, 1)";
    if (attack == 1) {
     if (eX > pX - 55 && eX < pX + 55 && eY > pY - 78 && eY < pY - 51) {
       eHealth -= 8;
     }
    } else if (attack == 2) {
    } else if (attack == 3) {
     if (eX > pX - 55 && eX < pX + 55 && eY > pY + 51 && eY < pY + 78) {
      eHealth -= 8;
     }
    } else if (attack == 4) {
    }
    if (hunger < 1) {
     pHealth -= 2;
    }
   }
   function nextLevel() {
     color = colorA[Math.round(Math.random() * (color.length - 1))];
    discRooms = 0;
       level++;
       screen = 2;
       room = 11;
       roomPos = "1,1";
       pX = 375;
       pY = 275;
       layout = [];
       layout[0] = {
        "type":11,
        "pos":"1,1"
       } 
       secretA = [];
   }
  </script>
 </head>
 <body onload="init()">
 </body>
<html>
